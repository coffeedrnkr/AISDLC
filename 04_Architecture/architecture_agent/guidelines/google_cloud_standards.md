# Architecture Standard: Google Cloud Platform (GCP)
**Status:** Approved
**Last Updated:** 2025-11-01

## 1. Compute
### 1.1 Preferred Services
-   **Cloud Run**: DEFAULT for all stateless microservices, web apps, and APIs.
    -   Must use 2nd Gen execution environment.
    -   Must enable "Always On" CPU if background processing is needed.
-   **Cloud Functions (Gen 2)**: Use ONLY for event-driven triggers (Pub/Sub, Storage events).
    -   Avoid for HTTP APIs (use Cloud Run instead).
-   **GKE Standard**: Use only for stateful workloads or complex orchestrations requiring custom operators.

### 1.2 Scaling
-   All services must auto-scale to zero unless "Always On" is justified.
-   Max instances must be set to prevent budget overruns (default: 100).

## 2. Database
### 2.1 Relational (SQL)
-   **Cloud SQL (PostgreSQL)**: Default for transactional data.
    -   Use Private Service Connect for connectivity.
    -   Enable automated backups (7 days retention).

### 2.2 NoSQL
-   **Firestore (Native Mode)**: Default for document storage, user profiles, and high-read scenarios.
-   **Memorystore (Redis)**: Default for caching session data and API responses.

## 3. Communication
-   **Internal (Service-to-Service)**:
    -   Must use gRPC where possible for performance.
    -   REST/HTTP/2 is acceptable for simple CRUD.
    -   Authentication: OIDC tokens generated by Cloud Run metadata server.
-   **External (Public)**:
    -   Must go through **API Gateway** or **Cloud Load Balancer**.
    -   Never expose Cloud Run services directly to public internet without a gateway/LB.

## 4. Security
-   **Secrets**: Must determine secrets from **Secret Manager**.
-   **Identity**: Use Workload Identity Federation for external service auth (e.g., GitHub Actions).
-   **VPC**: All compute resources must be attached to the shared VPC via Serverless VPC Accessor (or Direct VPC Egress).
